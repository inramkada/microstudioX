<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>microstudioX</title>
<meta name="description" content="Creative technology studio. Vanilla. Haskell. No frameworks." />
<meta property="og:title" content="microstudioX" />
<meta property="og:description" content="Creative technology studio. Vanilla. Haskell. No frameworks." />
<meta property="og:type" content="website" />
<meta name="referrer" content="no-referrer" />
<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />
<meta name="color-scheme" content="dark" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fragment+Mono&display=swap" rel="stylesheet">

<style>
  html, body {
    margin:0; height:100%;
    background:#000; color:#fff;
    font-family: 'Fragment Mono', ui-monospace, monospace;
    overflow:hidden;
  }

  @media (prefers-reduced-motion: reduce){
    *,*::before,*::after{
      animation-duration:0.01ms !important;
      animation-iteration-count:1 !important;
      transition-duration:0.01ms !important;
    }
    #bg{ opacity:.35; }
  }

  /* ===== Background video ===== */
  .bg-fallback{
    position:fixed; inset:0;
    z-index:0;
    background:#000;
  }

  #bgWrap {
    position:fixed; inset:0;
    z-index:1;
    pointer-events:none;
    overflow:hidden;
  }

  #bg {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    object-position:50% 50%;
    opacity:0;
    transition: opacity 800ms ease;
    will-change: opacity;
    background:#000;
  }
  #bg.is-visible { opacity:1; }

  /* ===== TOPBAR ===== */
  .topbar {
    position:fixed;
    top:18px; right:18px;
    z-index:9999;
    display:flex;
    align-items:center;
    gap:22px;
    user-select:none;
    -webkit-user-select:none;
  }

  /* Brand */
  .brand {
    font-size:14px;
    font-weight:400;
    letter-spacing:0.04em;
    white-space:nowrap;
    color:#fff;
  }
  .brand .X { text-transform:uppercase; }

  /* RGB chromatic aberration effect */
  .rgb-text {
    position:relative;
    color:#fff;
    display:inline-block;
  }
  .rgb-text::before,
  .rgb-text::after {
    content: attr(data-text);
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    pointer-events:none;
    white-space:nowrap;
  }
  .rgb-text::before {
    color: rgba(255,30,80,0.80);
    animation: rgb-r 5s ease-in-out infinite;
    mix-blend-mode: screen;
  }
  .rgb-text::after {
    color: rgba(0,210,255,0.80);
    animation: rgb-b 5s ease-in-out infinite;
    mix-blend-mode: screen;
  }

  @keyframes rgb-r {
    0%,100% { transform: translate(0,0); opacity:0; }
    15%     { transform: translate(-2.5px,0.5px); opacity:1; }
    30%     { transform: translate(-1.5px,-0.5px); opacity:0.7; }
    45%     { transform: translate(-3px,0); opacity:1; }
    60%     { transform: translate(0,0); opacity:0; }
  }
  @keyframes rgb-b {
    0%,100% { transform: translate(0,0); opacity:0; }
    15%     { transform: translate(2.5px,-0.5px); opacity:1; }
    30%     { transform: translate(1.5px,0.5px); opacity:0.7; }
    45%     { transform: translate(3px,0); opacity:1; }
    60%     { transform: translate(0,0); opacity:0; }
  }

  /* Stagger each topbar child */
  .topbar > *:nth-child(1) .rgb-text::before,
  .topbar > *:nth-child(1) .rgb-text::after { animation-delay:0s; }
  .topbar > *:nth-child(2) .rgb-text::before,
  .topbar > *:nth-child(2) .rgb-text::after { animation-delay:0.4s; }
  .topbar > *:nth-child(3) .rgb-text::before,
  .topbar > *:nth-child(3) .rgb-text::after { animation-delay:0.9s; }
  .topbar > *:nth-child(4) .rgb-text::before,
  .topbar > *:nth-child(4) .rgb-text::after { animation-delay:1.4s; }
  .topbar > *:nth-child(5) .rgb-text::before,
  .topbar > *:nth-child(5) .rgb-text::after { animation-delay:1.9s; }

  .toplink {
    font-size:11px;
    letter-spacing:.18em;
    text-transform:uppercase;
    white-space:nowrap;
    cursor:pointer;
    color:rgba(255,255,255,.80);
    transition: color 160ms ease;
  }
  .toplink:hover { color:#fff; }

  /* ===== LANG globe ===== */
  .lang {
    position:relative;
    display:flex;
    align-items:center;
  }
  .lang-btn {
    display:flex; align-items:center; justify-content:center;
    width:28px; height:28px;
    border-radius:999px;
    cursor:pointer;
    color:rgba(255,255,255,.85);
  }
  .lang-btn svg { width:18px; height:18px; opacity:.85; }

  .lang-row {
    position:absolute;
    right:100%; top:50%;
    transform:translateY(-50%) translateX(-14px);
    display:flex; align-items:center; gap:18px;
    opacity:0; pointer-events:none; white-space:nowrap;
    transition: opacity 160ms ease;
  }
  .lang.is-open .lang-row { opacity:1; pointer-events:auto; }
  .lang-chip {
    font-size:10px; letter-spacing:.18em; text-transform:uppercase;
    opacity:.65; cursor:pointer;
    transition: opacity 160ms;
  }
  .lang-chip:hover { opacity:.96; text-decoration:underline; text-underline-offset:7px; }

  /* ===== Footer — color limpio, sin mix-blend-mode ===== */
  .index-footer {
    position:fixed; left:0; right:0; bottom:18px;
    z-index:9998;
    text-align:center;
    font-size:9px; letter-spacing:.16em; text-transform:uppercase;
    color:rgba(255,255,255,.55);
    padding:0 18px;
    pointer-events:auto;
    user-select:none; -webkit-user-select:none;
  }
  .index-footer a {
    color:rgba(255,255,255,.65);
    text-decoration:none;
    border-bottom:1px solid rgba(255,255,255,.22);
    padding-bottom:2px;
    transition: color 160ms, border-color 160ms;
  }
  .index-footer a:hover { color:#fff; border-bottom-color:rgba(255,255,255,.60); }

  /* ===== SOUND FAB ===== */
  .sound-fab {
    position:fixed; right:18px; bottom:18px;
    z-index:9999;
    display:flex; align-items:center; gap:14px;
    cursor:pointer; user-select:none; -webkit-user-select:none;
    color:rgba(255,255,255,.90);
    transform:translateZ(0); pointer-events:auto;
  }
  .sound-ico { width:36px; height:36px; opacity:.85; transform-origin:50% 50%; }
  .sound-off { display:none; }
  .sound-fab.is-muted .sound-on { display:none; }
  .sound-fab.is-muted .sound-off { display:block; }
  .sound-label {
    font-size:9px; letter-spacing:.18em; text-transform:uppercase;
    opacity:0; pointer-events:none; transform:translateX(8px); white-space:nowrap;
    transition: opacity 160ms, transform 160ms;
  }
  .sound-fab:hover .sound-label { opacity:.60; transform:translateX(0); }
  .sound-fab.is-pulse .sound-ico { animation: soundPulse 120ms ease-out; }
  @keyframes soundPulse {
    0%{ transform:scale(1); } 50%{ transform:scale(1.08); } 100%{ transform:scale(1); }
  }

  /* ===== ABOUT OVERLAY ===== */
  .about-overlay {
    position:fixed; inset:0; z-index:2000;
    display:none; pointer-events:none;
  }
  .about-overlay.is-open { display:block; pointer-events:auto; }
  .about-dim { position:absolute; inset:0; background:rgba(0,0,0,.60); }
  .about-stage {
    position:absolute; inset:0;
    display:grid; place-items:center;
    padding:min(6vh,48px) 0;
  }
  .about-shell {
    position:relative; width:100vw;
    background:#000; overflow:hidden;
  }
  .about-actions {
    position:absolute; top:18px; right:18px;
    display:flex; align-items:center; gap:14px;
    z-index:7; direction:ltr;
  }
  .about-close {
    position:static;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.04);
    border-radius:999px;
    padding:10px 14px;
    font-size:10px;
    font-family:'Fragment Mono', ui-monospace, monospace;
    letter-spacing:.16em; text-transform:uppercase;
    color:rgba(255,255,255,.86); cursor:pointer;
    transition: background 160ms, border-color 160ms;
  }
  .about-close:hover { background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.28); }

  .about-tts {
    position:relative; width:22px; height:22px;
    padding:0; border:0; background:transparent;
    display:inline-grid; place-items:center;
    cursor:pointer; color:rgba(255,255,255,.82); opacity:.85;
  }
  .about-tts:hover { opacity:1; }
  .about-tts:focus { outline:2px solid rgba(255,255,255,.22); outline-offset:6px; border-radius:10px; }
  .about-tts .tts-icon {
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    font-size:13px; line-height:1;
    transition:opacity 160ms; opacity:0; pointer-events:none;
  }
  .about-tts .tts-reader { opacity:.95; }
  @media (hover:hover) and (pointer:fine){
    .about-tts:hover .tts-reader { opacity:0; }
    .about-tts:hover .tts-play { opacity:1; }
    .about-tts.is-playing:hover .tts-play { opacity:0; }
    .about-tts.is-playing:hover .tts-pause { opacity:1; }
    .about-tts.is-paused:hover .tts-play { opacity:1; }
  }
  @media (hover:none){ .about-tts .tts-reader { opacity:.95; } }

  .edge-arrow {
    position:absolute; top:50%; transform:translateY(-50%);
    width:56px; height:120px; border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.04);
    display:grid; place-items:center;
    cursor:pointer; opacity:0; pointer-events:none;
    z-index:7; user-select:none; -webkit-user-select:none;
    transition: opacity 160ms;
  }
  .edge-arrow.left { left:18px; }
  .edge-arrow.right { right:18px; }
  .edge-arrow svg { width:22px; height:22px; opacity:.9; }
  .about-shell.is-hot .edge-arrow { opacity:.9; pointer-events:auto; }
  .edge-arrow.is-disabled { opacity:.18 !important; pointer-events:none !important; }

  .about-index {
    position:absolute; left:24px; bottom:18px;
    font-size:9px; letter-spacing:.16em; text-transform:uppercase;
    opacity:.45; pointer-events:none; z-index:6;
  }

  .about-track {
    display:flex; overflow:hidden;
    scroll-snap-type:x mandatory; scroll-behavior:smooth;
    touch-action:pan-x pinch-zoom;
  }
  .about-panel { min-width:100%; scroll-snap-align:start; padding:56px 0; box-sizing:border-box; }
  .about-inner { width:min(1100px,calc(100vw - 96px)); margin:0 auto; }

  .about-grid { display:grid; grid-template-columns:1.05fr .95fr; gap:48px; align-items:start; }
  .about-media {
    height:min(52vh,520px); border-radius:26px; overflow:hidden;
    background:#0a0a0a; border:1px solid rgba(255,255,255,.08); position:relative;
  }
  .about-media::before {
    content:""; position:absolute; inset:0;
    background:
      radial-gradient(900px 550px at 70% 25%, rgba(255,255,255,.07), transparent 55%),
      linear-gradient(to bottom, rgba(0,0,0,.10), rgba(0,0,0,.65));
    opacity:.95;
  }

  .about-kicker { font-size:9px; letter-spacing:.22em; text-transform:uppercase; opacity:.45; margin:0 0 14px; }
  .about-title { margin:0 0 20px; font-size:22px; line-height:1.2; letter-spacing:.04em; text-transform:uppercase; color:rgba(255,255,255,.92); }
  .about-p { margin:0 0 16px; font-size:12px; line-height:1.75; opacity:.62; max-width:68ch; }
  .about-hr { height:1px; background:rgba(255,255,255,.08); margin:20px 0; }

  .contact-link {
    display:inline-block; font-size:12px; letter-spacing:.06em;
    color:rgba(255,255,255,.86); text-decoration:none;
    border-bottom:1px solid rgba(255,255,255,.22); padding-bottom:3px; margin-top:8px;
    transition: color 160ms, border-color 160ms;
  }
  .contact-link:hover { color:#fff; border-bottom-color:rgba(255,255,255,.65); }

  .services-grid {
    display:grid; grid-template-columns:repeat(3,1fr);
    gap:1px; background:rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.07); margin-top:32px;
  }
  .svc { background:#000; padding:32px 28px; }
  .svc-num { font-size:9px; letter-spacing:.2em; color:rgba(255,255,255,.30); margin-bottom:16px; }
  .svc-name { font-size:11px; letter-spacing:.1em; text-transform:uppercase; color:rgba(255,255,255,.88); margin-bottom:12px; }
  .svc-desc { font-size:10px; letter-spacing:.04em; color:rgba(255,255,255,.45); line-height:1.85; }

  .about-dots {
    position:absolute; left:50%; transform:translateX(-50%); bottom:18px;
    z-index:8; display:flex; gap:10px; opacity:.70; pointer-events:auto;
  }
  .dot { width:6px; height:6px; border-radius:999px; border:1px solid rgba(255,255,255,.28); background:transparent; cursor:pointer; transition: background 160ms; }
  .dot.is-active { background:rgba(255,255,255,.60); border-color:rgba(255,255,255,.60); }
  @media (min-width:981px){ .about-dots { display:none; } }

  @media (max-width:980px){
    .about-inner { width:min(1100px,calc(100vw - 44px)); }
    .about-grid { grid-template-columns:1fr; }
    .about-media { height:40vh; }
    .edge-arrow { opacity:.88; pointer-events:auto; height:92px; width:52px; }
    .services-grid { grid-template-columns:1fr; }
  }

  .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  html[dir="rtl"] .topbar { left:auto; right:18px; flex-direction:row-reverse; }
  html[dir="rtl"] .lang-row { left:auto; right:100%; flex-direction:row-reverse; }
  html[dir="rtl"] .sound-fab { left:auto; right:18px; flex-direction:row-reverse; }
  html[dir="rtl"] .sound-label { transform:translateX(-8px); }
  html[dir="rtl"] .sound-fab:hover .sound-label { transform:translateX(0); }
</style>
</head>

<body>
<div class="bg-fallback" aria-hidden="true"></div>

<div id="bgWrap" aria-hidden="true">
  <video id="bg" playsinline preload="metadata" muted>
    <source src="assets/video1.mp4" type="video/mp4">
  </video>
</div>

<div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>

<!-- TOPBAR -->
<div class="topbar">
  <div class="lang" id="langWrap" aria-label="Language">
    <div class="lang-btn" id="langBtn" title="Language" role="button" tabindex="0" aria-haspopup="true" aria-expanded="false">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="1.9"/>
        <path d="M2.5 12h19" stroke="currentColor" stroke-width="1.9" stroke-linecap="round"/>
        <path d="M12 2c2.8 2.8 2.8 16.2 0 20" stroke="currentColor" stroke-width="1.9" stroke-linecap="round"/>
        <path d="M12 2c-2.8 2.8-2.8 16.2 0 20" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" opacity=".85"/>
      </svg>
    </div>
    <div class="lang-row" aria-hidden="true">
      <span class="lang-chip" data-lang="en">EN</span>
      <span class="lang-chip" data-lang="es">ES</span>
    </div>
  </div>

  <div class="brand">
    <span class="rgb-text" data-text="microstudioX">microstudio<span class="X">X</span></span>
  </div>

  <div class="toplink" id="aboutBtn">
    <span class="rgb-text" data-i18n="top_about" data-text="ABOUT">ABOUT</span>
  </div>
  <div class="toplink" id="servicesBtn">
    <span class="rgb-text" data-i18n="top_services" data-text="SERVICES">SERVICES</span>
  </div>
  <div class="toplink" id="contactBtn">
    <span class="rgb-text" data-i18n="top_contact" data-text="CONTACT">CONTACT</span>
  </div>
</div>

<!-- Footer -->
<div class="index-footer" data-i18n="footer_html">
  <a href="https://www.microretailx.com" target="_blank" rel="noopener">MICRORETAILX LLC</a>
  · microstudioX · CREATIVE TECHNOLOGY STUDIO
</div>

<!-- ABOUT overlay -->
<div class="about-overlay" id="aboutOverlay" aria-hidden="true">
  <div class="about-dim" id="aboutDim"></div>
  <div class="about-stage">
    <div class="about-shell" id="aboutShell" role="dialog" aria-modal="true" aria-label="Panels">

      <div class="about-actions">
        <button class="about-tts" id="aboutSpeak" type="button" aria-label="Immersive reader" aria-pressed="false" title="Immersive reader">
          <span class="tts-icon tts-reader" aria-hidden="true">⌁</span>
          <span class="tts-icon tts-play" aria-hidden="true">▶</span>
          <span class="tts-icon tts-pause" aria-hidden="true">⏸</span>
        </button>
        <button class="about-close" id="aboutClose" type="button" data-i18n="ui_close">CLOSE</button>
      </div>

      <span class="sr-only" id="ttsStatus" aria-live="polite" aria-atomic="true"></span>

      <div class="edge-arrow left" id="prevBtn" title="Previous">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M14.5 5L8 12l6.5 7" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="edge-arrow right" id="nextBtn" title="Next">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M9.5 5L16 12l-6.5 7" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <div class="about-index" id="aboutIndex">01 / 03</div>

      <div class="about-dots" id="aboutDots" aria-label="Pagination">
        <div class="dot is-active" data-dot="0" role="button" tabindex="0" aria-label="Page 1"></div>
        <div class="dot" data-dot="1" role="button" tabindex="0" aria-label="Page 2"></div>
        <div class="dot" data-dot="2" role="button" tabindex="0" aria-label="Page 3"></div>
      </div>

      <div class="about-track" id="aboutTrack">

        <section class="about-panel" data-panel="about">
          <div class="about-inner">
            <div class="about-grid">
              <div class="about-media" aria-hidden="true"></div>
              <div>
                <div class="about-kicker" data-i18n="about_kicker">ABOUT</div>
                <h2 class="about-title" data-i18n="about_title">CREATIVE TECHNOLOGY STUDIO.</h2>
                <p class="about-p" data-i18n="about_p1">microstudioX is the creative technology arm of MICRORETAILX LLC. We build interfaces that demand to be noticed — written in pure vanilla and Haskell, without abstraction layers, without shortcuts.</p>
                <div class="about-hr"></div>
                <p class="about-p" data-i18n="about_p2">Our primary mission is to serve MICRORETAILX and its group verticals. External work is selective and by introduction only.</p>
                <p class="about-p" data-i18n="about_p3">No frameworks. No dependencies. Pure craft.</p>
              </div>
            </div>
          </div>
        </section>

        <section class="about-panel" data-panel="services">
          <div class="about-inner">
            <div class="about-kicker" data-i18n="svc_kicker">SERVICES</div>
            <h2 class="about-title" data-i18n="svc_title">WHAT WE BUILD</h2>
            <div class="services-grid">
              <div class="svc">
                <div class="svc-num">01</div>
                <div class="svc-name" data-i18n="svc1_name">Interface Engineering</div>
                <div class="svc-desc" data-i18n="svc1_desc">Production-grade web interfaces built from first principles. No framework overhead. Maximum performance. Vanilla JS, CSS, HTML.</div>
              </div>
              <div class="svc">
                <div class="svc-num">02</div>
                <div class="svc-name" data-i18n="svc2_name">Creative Coding</div>
                <div class="svc-desc" data-i18n="svc2_desc">WebGL shaders, generative systems, motion design. Code as visual language, written at the metal. GLSL, Canvas API.</div>
              </div>
              <div class="svc">
                <div class="svc-num">03</div>
                <div class="svc-name" data-i18n="svc3_name">Functional Systems</div>
                <div class="svc-desc" data-i18n="svc3_desc">Backend logic and data pipelines in Haskell. Type-safe, correct by construction, built to last.</div>
              </div>
            </div>
          </div>
        </section>

        <section class="about-panel" data-panel="contact">
          <div class="about-inner">
            <div class="about-kicker" data-i18n="contact_kicker">CONTACT</div>
            <h2 class="about-title" data-i18n="contact_title">LET'S TALK</h2>
            <p class="about-p" data-i18n="contact_p1">External work is selective. We respond to serious inquiries only.</p>
            <div class="about-hr"></div>
            <p class="about-p" data-i18n="contact_p2">For project inquiries or partnership discussions, reach out directly.</p>
            <a href="mailto:studio@microretailx.com" class="contact-link">studio@microretailx.com</a>
          </div>
        </section>

      </div>
    </div>
  </div>
</div>

<!-- SOUND FAB -->
<div class="sound-fab" id="soundFab" role="button" tabindex="0" aria-label="Sound toggle">
  <span class="sound-label" id="soundLabel">SOUND OFF</span>
  <svg class="sound-ico sound-on" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M11 5.5L7.8 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2.8L11 18.5a1 1 0 0 0 1.6-.8V6.3a1 1 0 0 0-1.6-.8Z" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linejoin="round"/>
    <path d="M15 9.1c1.15.9 1.15.9 1.15 2.9s0 2-1.15 2.9" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round"/>
    <path d="M17.5 7.2c1.9 1.65 1.9 1.65 1.9 4.8s0 3.15-1.9 4.8" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" opacity=".88"/>
  </svg>
  <svg class="sound-ico sound-off" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M11 5.5L7.8 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2.8L11 18.5a1 1 0 0 0 1.6-.8V6.3a1 1 0 0 0-1.6-.8Z" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linejoin="round"/>
    <path d="M18.8 7.2L7.2 18.8" fill="none" stroke="currentColor" stroke-width="3.2" stroke-linecap="round"/>
  </svg>
</div>

<script>
function $(id){ return document.getElementById(id); }

/* =========================
   VIDEO — cinematic, no loop
   Play full → fade 800ms → pause 3s → nuevo tercio → fade in → play
========================= */
(function initVideo(){
  const video = $("bg");
  if(!video) return;

  // Tres "tercios" de encuadre
  const THIRDS = [
    "20% 50%",   // izquierda
    "50% 50%",   // centro
    "80% 50%"    // derecha
  ];

  let current = Math.floor(Math.random() * THIRDS.length);

  function setThird(i){
    video.style.objectFit      = "cover";
    video.style.objectPosition = THIRDS[i];
  }

  function pickNext(){
    let n;
    do { n = Math.floor(Math.random() * THIRDS.length); }
    while(n === current && THIRDS.length > 1);
    current = n;
    return n;
  }

  function cycle(){
    setThird(current);
    video.currentTime = 0;
    video.play().catch(()=>{});
    video.classList.add("is-visible");

    video.onended = function(){
      // Fade out
      video.classList.remove("is-visible");

      // Esperar 800ms (fade) + 3000ms (pausa) = 3800ms
      setTimeout(function(){
        pickNext();
        setThird(current);
        // Doble rAF para asegurar repaint antes de fade-in
        requestAnimationFrame(function(){
          requestAnimationFrame(function(){
            video.currentTime = 0;
            video.play().catch(()=>{});
            video.classList.add("is-visible");
          });
        });
      }, 3800);
    };
  }

  if(video.readyState >= 2){
    cycle();
  } else {
    video.addEventListener("canplay", cycle, { once:true });
  }
})();

/* =========================
   RGB data-text sync
========================= */
function syncRgbDataText(){
  document.querySelectorAll(".rgb-text").forEach(function(el){
    // Para el brand: el textContent incluye "microstudioX"
    el.setAttribute("data-text", el.textContent.trim());
  });
}

/* =========================
   I18N
========================= */
const SUPPORTED = ["en","es"];
const I18N = {
  en:{
    top_about:"ABOUT", top_services:"SERVICES", top_contact:"CONTACT", ui_close:"CLOSE",
    footer_html:`<a href="https://www.microretailx.com" target="_blank" rel="noopener">MICRORETAILX LLC</a> · microstudioX · CREATIVE TECHNOLOGY STUDIO`,
    about_kicker:"ABOUT", about_title:"CREATIVE TECHNOLOGY STUDIO.",
    about_p1:"microstudioX is the creative technology arm of MICRORETAILX LLC. We build interfaces that demand to be noticed — written in pure vanilla and Haskell, without abstraction layers, without shortcuts.",
    about_p2:"Our primary mission is to serve MICRORETAILX and its group verticals. External work is selective and by introduction only.",
    about_p3:"No frameworks. No dependencies. Pure craft.",
    svc_kicker:"SERVICES", svc_title:"WHAT WE BUILD",
    svc1_name:"Interface Engineering", svc1_desc:"Production-grade web interfaces built from first principles. No framework overhead. Maximum performance. Vanilla JS, CSS, HTML.",
    svc2_name:"Creative Coding", svc2_desc:"WebGL shaders, generative systems, motion design. Code as visual language, written at the metal. GLSL, Canvas API.",
    svc3_name:"Functional Systems", svc3_desc:"Backend logic and data pipelines in Haskell. Type-safe, correct by construction, built to last.",
    contact_kicker:"CONTACT", contact_title:"LET'S TALK",
    contact_p1:"External work is selective. We respond to serious inquiries only.",
    contact_p2:"For project inquiries or partnership discussions, reach out directly.",
    top_sound_on_off:{on:"SOUND ON", off:"SOUND OFF"}
  },
  es:{
    top_about:"INFO", top_services:"SERVICIOS", top_contact:"CONTACTO", ui_close:"CERRAR",
    footer_html:`<a href="https://www.microretailx.com" target="_blank" rel="noopener">MICRORETAILX LLC</a> · microstudioX · ESTUDIO DE TECNOLOGÍA CREATIVA`,
    about_kicker:"ABOUT", about_title:"ESTUDIO DE TECNOLOGÍA CREATIVA.",
    about_p1:"microstudioX es el brazo de tecnología creativa de MICRORETAILX LLC. Construimos interfaces que exigen ser vistas — escritas en vanilla puro y Haskell, sin capas de abstracción, sin atajos.",
    about_p2:"Nuestra misión principal es dar servicio a MICRORETAILX y sus verticales. El trabajo externo es selectivo y solo por introducción.",
    about_p3:"Sin frameworks. Sin dependencias. Artesanía pura.",
    svc_kicker:"SERVICIOS", svc_title:"QUÉ CONSTRUIMOS",
    svc1_name:"Ingeniería de interfaces", svc1_desc:"Interfaces web de producción construidas desde cero. Sin overhead de frameworks. Máximo rendimiento. Vanilla JS, CSS, HTML.",
    svc2_name:"Creative Coding", svc2_desc:"Shaders WebGL, sistemas generativos, motion design. Código como lenguaje visual, escrito al metal. GLSL, Canvas API.",
    svc3_name:"Sistemas funcionales", svc3_desc:"Lógica de backend y pipelines de datos en Haskell. Type-safe, correcto por construcción, construido para durar.",
    contact_kicker:"CONTACTO", contact_title:"HABLEMOS",
    contact_p1:"El trabajo externo es selectivo. Respondemos solo a consultas serias.",
    contact_p2:"Para consultas de proyectos o discusiones de colaboración, escríbenos directamente.",
    top_sound_on_off:{on:"SONIDO ON", off:"SONIDO OFF"}
  }
};

function currentDict(){ return I18N[localStorage.getItem("msx_lang")||"en"]||I18N.en; }

function applyLanguage(lang){
  if(!SUPPORTED.includes(lang)) lang="en";
  localStorage.setItem("msx_lang",lang);
  document.documentElement.setAttribute("lang",lang);
  document.documentElement.setAttribute("dir","ltr");
  var dict=currentDict();
  document.querySelectorAll("[data-i18n]").forEach(function(el){
    var key=el.getAttribute("data-i18n");
    if(key==="footer_html") return;
    if(dict[key]!==undefined) el.textContent=dict[key];
  });
  var footer=document.querySelector("[data-i18n='footer_html']");
  if(footer&&dict.footer_html) footer.innerHTML=dict.footer_html;
  syncRgbDataText();
  syncSoundUI();
}
window.applyLanguage=applyLanguage;

/* =========================
   LANG UI
========================= */
function initLang(){
  var wrap=$("langWrap"), btn=$("langBtn");
  if(!wrap||!btn) return;
  var open=function(){ wrap.classList.add("is-open"); btn.setAttribute("aria-expanded","true"); };
  var close=function(){ wrap.classList.remove("is-open"); btn.setAttribute("aria-expanded","false"); };
  var toggle=function(e){ e.stopPropagation(); wrap.classList.contains("is-open")?close():open(); };
  btn.addEventListener("click",toggle);
  btn.addEventListener("keydown",function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(e); } });
  wrap.addEventListener("click",function(e){ e.stopPropagation(); });
  document.addEventListener("click",close);
  document.querySelectorAll(".lang-chip").forEach(function(chip){
    chip.addEventListener("click",function(e){
      e.stopPropagation();
      applyLanguage(chip.getAttribute("data-lang"));
      close();
    });
  });
}

/* =========================
   SOUND
========================= */
function getSoundRefs(){ return {v:$("bg"),fab:$("soundFab"),label:$("soundLabel")}; }
function syncSoundUI(){
  var r=getSoundRefs();
  if(!r.v||!r.fab||!r.label) return;
  var muted=!!r.v.muted;
  r.fab.classList.toggle("is-muted",muted);
  var dict=currentDict();
  var txt=muted?"SOUND OFF":"SOUND ON";
  if(dict&&dict.top_sound_on_off) txt=dict.top_sound_on_off[muted?"off":"on"]||txt;
  r.label.textContent=txt;
}
var lastToggleAt=0;
function toggleSound(e){
  if(e){e.stopPropagation();e.preventDefault();}
  var now=performance.now();
  if(now-lastToggleAt<220) return;
  lastToggleAt=now;
  var r=getSoundRefs();
  if(!r.v||!r.fab) return;
  r.fab.classList.remove("is-pulse");
  void r.fab.offsetWidth;
  r.fab.classList.add("is-pulse");
  setTimeout(function(){ r.fab.classList.remove("is-pulse"); },140);
  r.v.muted=!r.v.muted;
  if(!r.v.muted){
    try{ r.v.volume=1; if(r.v.paused) r.v.play(); }
    catch(_){ r.v.muted=true; }
  }
  syncSoundUI();
}
function initSound(){
  var r=getSoundRefs();
  if(!r.fab) return;
  r.fab.addEventListener("pointerdown",toggleSound,{passive:false});
  r.fab.addEventListener("click",toggleSound,{passive:false});
  r.fab.addEventListener("keydown",function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggleSound(e); } });
  syncSoundUI();
}

/* =========================
   ABOUT modal
========================= */
function initAbout(){
  var overlay=$("aboutOverlay"),dim=$("aboutDim"),closeBtn=$("aboutClose"),shell=$("aboutShell"),track=$("aboutTrack");
  if(!overlay||!dim||!closeBtn||!shell||!track) return;
  var panels=Array.from(track.querySelectorAll(".about-panel"));
  var prevBtn=$("prevBtn"),nextBtn=$("nextBtn"),indexEl=$("aboutIndex");
  var dotsWrap=$("aboutDots"),dots=dotsWrap?Array.from(dotsWrap.querySelectorAll(".dot")):[];
  var announcer=$("announcer");
  var lastFocus=null;

  var w=function(){ return track.clientWidth||window.innerWidth; };
  var idx=function(){ return Math.round(track.scrollLeft/w()); };
  var clamp=function(n,a,b){ return Math.max(a,Math.min(b,n)); };

  function updateDots(i){ dots.forEach(function(d,di){ d.classList.toggle("is-active",di===i); }); }
  function updateNav(){
    var i=idx();
    if(indexEl) indexEl.textContent=String(i+1).padStart(2,"0")+" / "+String(panels.length).padStart(2,"0");
    if(prevBtn) prevBtn.classList.toggle("is-disabled",i===0);
    if(nextBtn) nextBtn.classList.toggle("is-disabled",i===panels.length-1);
    updateDots(i);
    if(announcer){ announcer.textContent="Panel "+(i+1)+" / "+panels.length; setTimeout(function(){ announcer.textContent=""; },900); }
  }
  function scrollToIndex(i){
    track.scrollTo({left:clamp(i,0,panels.length-1)*w(),behavior:"smooth"});
    setTimeout(updateNav,120);
  }
  function trapFocus(e){
    if(!overlay.classList.contains("is-open")||e.key!=="Tab") return;
    var list=Array.from(overlay.querySelectorAll('button,[role="button"],[tabindex="0"],a[href]')).filter(function(el){ return !el.classList.contains("is-disabled")&&el.offsetParent!==null; });
    if(!list.length) return;
    var first=list[0],last=list[list.length-1];
    if(e.shiftKey&&document.activeElement===first){ e.preventDefault(); last.focus(); }
    else if(!e.shiftKey&&document.activeElement===last){ e.preventDefault(); first.focus(); }
  }
  function openAbout(panelKey){
    lastFocus=document.activeElement;
    overlay.classList.add("is-open");
    overlay.setAttribute("aria-hidden","false");
    document.body.style.overflow="hidden";
    var i=0;
    if(panelKey){ var f=panels.findIndex(function(p){ return p.dataset.panel===panelKey; }); i=f>=0?f:0; }
    scrollToIndex(i); updateNav();
    setTimeout(function(){ closeBtn.focus(); },0);
  }
  function closeAbout(){
    overlay.classList.remove("is-open");
    overlay.setAttribute("aria-hidden","true");
    document.body.style.overflow="";
    shell.classList.remove("is-hot");
    if(lastFocus&&typeof lastFocus.focus==="function") lastFocus.focus();
  }

  var ab=$("aboutBtn"),sb=$("servicesBtn"),cb=$("contactBtn");
  if(ab) ab.addEventListener("click",function(){ openAbout("about"); });
  if(sb) sb.addEventListener("click",function(){ openAbout("services"); });
  if(cb) cb.addEventListener("click",function(){ openAbout("contact"); });

  dim.addEventListener("click",closeAbout);
  closeBtn.addEventListener("click",closeAbout);
  document.addEventListener("keydown",function(e){
    if(!overlay.classList.contains("is-open")) return;
    if(e.key==="Escape") closeAbout();
    if(e.key==="ArrowLeft") scrollToIndex(idx()-1);
    if(e.key==="ArrowRight") scrollToIndex(idx()+1);
    trapFocus(e);
  });
  if(prevBtn) prevBtn.addEventListener("click",function(){ scrollToIndex(idx()-1); });
  if(nextBtn) nextBtn.addEventListener("click",function(){ scrollToIndex(idx()+1); });
  track.addEventListener("scroll",function(){ updateNav(); },{passive:true});
  dots.forEach(function(d){
    var go=function(){ scrollToIndex(parseInt(d.getAttribute("data-dot"),10)); };
    d.addEventListener("click",go);
    d.addEventListener("keydown",function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); go(); } });
  });
  var hotT=null;
  shell.addEventListener("mousemove",function(e){
    var r=shell.getBoundingClientRect(), x=e.clientX-r.left;
    if(x<140||x>r.width-140){
      shell.classList.add("is-hot");
      clearTimeout(hotT);
      hotT=setTimeout(function(){ shell.classList.remove("is-hot"); },1000);
    }
  });
  shell.addEventListener("mouseleave",function(){ shell.classList.remove("is-hot"); });
  window.addEventListener("resize",function(){ scrollToIndex(idx()); updateNav(); });
  updateNav();
}

/* =========================
   IMMERSIVE READER TTS
========================= */
function ttsLang(l){ return l==="es"?"es-ES":"en-US"; }
function pickVoice(tag){
  var voices=window.speechSynthesis&&window.speechSynthesis.getVoices?window.speechSynthesis.getVoices():[];
  if(!voices.length) return null;
  var p=String(tag||"").toLowerCase(), b=p.split("-")[0];
  return voices.find(function(v){ return (v.lang||"").toLowerCase()===p; })||
         voices.find(function(v){ return (v.lang||"").toLowerCase().startsWith(b); })||
         voices.find(function(v){ return v.default; })||voices[0]||null;
}
function buildAboutText(){
  var track=$("aboutTrack");
  if(!track) return "";
  var panels=Array.from(track.querySelectorAll(".about-panel"));
  var w=track.clientWidth||window.innerWidth;
  var i=Math.max(0,Math.min(Math.round(track.scrollLeft/w),panels.length-1));
  var p=panels[i]; if(!p) return "";
  var kicker=(p.querySelector(".about-kicker")||{}).textContent||"";
  var title=(p.querySelector(".about-title")||{}).textContent||"";
  var paras=Array.from(p.querySelectorAll(".about-p")).map(function(el){ return (el.textContent||"").trim(); }).filter(Boolean);
  return [kicker.trim(),title.trim()].concat(paras).filter(Boolean).join(". ");
}
function initImmersiveTTS(){
  var btn=$("aboutSpeak"),overlay=$("aboutOverlay"),closeBtn=$("aboutClose"),dim=$("aboutDim"),status=$("ttsStatus");
  if(!btn||!("speechSynthesis" in window)) return;
  var lastState="idle";
  function setState(s){
    lastState=s;
    btn.classList.toggle("is-playing",s==="playing");
    btn.classList.toggle("is-paused",s==="paused");
    btn.setAttribute("aria-pressed",s==="playing"?"true":"false");
    if(status){ status.textContent=s==="playing"?"Reading.":(s==="paused"?"Paused.":"Stopped."); setTimeout(function(){ status.textContent=""; },650); }
  }
  function stop(){ try{window.speechSynthesis.cancel();}catch(_){} setState("idle"); }
  function speak(){
    var text=buildAboutText(); if(!text){ stop(); return; }
    try{window.speechSynthesis.cancel();}catch(_){}
    var tag=ttsLang(localStorage.getItem("msx_lang")||"en");
    var u=new SpeechSynthesisUtterance(text); u.lang=tag;
    var v=pickVoice(tag); if(v) u.voice=v;
    u.onend=function(){ setState("idle"); };
    u.onerror=function(){ setState("idle"); };
    setState("playing"); window.speechSynthesis.speak(u);
  }
  function toggle(){
    if(overlay&&!overlay.classList.contains("is-open")) return;
    var s=window.speechSynthesis;
    if(s.speaking){ s.paused?(s.resume(),setState("playing")):(s.pause(),setState("paused")); return; }
    speak();
  }
  window.speechSynthesis.onvoiceschanged=function(){};
  btn.addEventListener("click",function(e){ e.stopPropagation(); toggle(); });
  btn.addEventListener("keydown",function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); } });
  if(closeBtn) closeBtn.addEventListener("click",stop);
  if(dim) dim.addEventListener("click",stop);
  document.addEventListener("keydown",function(e){ if(e.key==="Escape"&&overlay&&overlay.classList.contains("is-open")) stop(); });
  setState("idle");
}

/* =========================
   Boot
========================= */
document.addEventListener("DOMContentLoaded",function(){
  initLang();
  initAbout();
  initSound();
  initImmersiveTTS();
  applyLanguage(localStorage.getItem("msx_lang")||"en");
  syncRgbDataText();
});
</script>
</body>
</html>
